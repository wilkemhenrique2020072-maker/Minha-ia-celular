<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wilken iA - Servidor</title>
    <style>
        /* Estilo Dark Futurista */
        body { 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            background: #0b0f1a; 
            color: #e2e8f0; 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
        }

        /* Tela de Carregamento / Scan */
        #loader { 
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            background: #0b0f1a; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            z-index: 9999; 
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(59, 130, 246, 0.1);
            border-left-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #status-text {
            margin-top: 20px;
            font-size: 18px;
            letter-spacing: 1px;
            color: #3b82f6;
            font-weight: bold;
        }

        /* Container Principal do Chat */
        .chat-app { 
            display: none; /* Escondido durante o scan */
            width: 95%; 
            max-width: 500px; 
            height: 90vh;
            background: #161e2d; 
            border-radius: 20px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid #1e293b;
        }

        .header { 
            padding: 20px; 
            background: #1e293b; 
            text-align: center; 
            font-weight: bold;
            font-size: 20px;
            color: #3b82f6;
            border-bottom: 1px solid #334155;
        }

        #chat-window { 
            flex: 1; 
            padding: 20px; 
            overflow-y: auto; 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
        }

        .msg { padding: 12px 16px; border-radius: 15px; max-width: 80%; line-height: 1.4; font-size: 15px; }
        .user { background: #3b82f6; color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        .ai { background: #334155; color: #f1f5f9; align-self: flex-start; border-bottom-left-radius: 2px; }

        .input-area { 
            padding: 20px; 
            background: #1e293b; 
            display: flex; 
            gap: 10px; 
        }

        input { 
            flex: 1; 
            padding: 12px; 
            border-radius: 10px; 
            border: 1px solid #334155; 
            background: #0b0f1a; 
            color: white; 
            outline: none; 
        }

        button { 
            background: #3b82f6; 
            color: white; 
            border: none; 
            padding: 0 20px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: bold; 
        }

        button:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <!-- TELA DE SCAN -->
    <div id="loader">
        <div class="spinner"></div>
        <div id="status-text">Conectando Servidor Wilken iA</div>
    </div>

    <!-- INTERFACE DA IA -->
    <div class="chat-app" id="chat-app" style="display: none;">
        <div class="header">Wilken iA Online</div>
        <div id="chat-window">
            <div class="msg ai">Servidor conectado com sucesso. Como posso te ajudar?</div>
        </div>
        <div class="input-area">
            <input type="text" id="userInput" placeholder="Envie uma mensagem...">
            <button onclick="askAI()" id="sendBtn">Enviar</button>
        </div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        // SUA CHAVE JÁ INSERIDA
        const API_KEY = "AIzaSyBDPCvjIGJ7I7D9rN36VmRuGue5hoELuaI"; 
        const genAI = new GoogleGenerativeAI(API_KEY);
        let model;

        // FUNÇÃO DE SCAN E CONEXÃO
        async function startSystem() {
            const statusLabel = document.getElementById('status-text');
            
            try {
                // Tentando o modelo mais estável primeiro
                model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                
                // Scan silencioso: verifica se o servidor responde
                await model.generateContent("check");

                // Se responder, abre o sistema
                showInterface();
            } catch (err) {
                console.log("Erro no flash, tentando Pro...");
                try {
                    // Fallback para o modelo Pro caso o Flash falhe na sua região
                    model = genAI.getGenerativeModel({ model: "gemini-pro" });
                    await model.generateContent("check");
                    showInterface();
                } catch (err2) {
                    statusLabel.innerText = "ERRO: Servidor Wilken iA Indisponível";
                    statusLabel.style.color = "red";
                }
            }
        }

        function showInterface() {
            document.getElementById('loader').style.display = 'none';
            document.getElementById('chat-app').style.display = 'flex';
        }

        window.askAI = async function() {
            const input = document.getElementById('userInput');
            const chatWindow = document.getElementById('chat-window');
            const btn = document.getElementById('sendBtn');
            
            if (!input.value.trim()) return;

            // Mostrar mensagem do usuário
            const userText = input.value;
            chatWindow.innerHTML += `<div class="msg user">${userText}</div>`;
            input.value = "";
            chatWindow.scrollTop = chatWindow.scrollHeight;

            btn.disabled = true;
            
            try {
                const result = await model.generateContent(userText);
                const response = await result.response;
                const text = response.text();
                
                chatWindow.innerHTML += `<div class="msg ai">${text}</div>`;
            } catch (error) {
                chatWindow.innerHTML += `<div class="msg ai" style="color: #ff4444;">Erro de Conexão: O servidor não respondeu adequadamente.</div>`;
            } finally {
                btn.disabled = false;
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }
        }

        // Iniciar Scan ao carregar a página
        startSystem();
    </script>
</body>
</html>
